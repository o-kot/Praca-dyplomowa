#error{class:'alert alert-danger', role:'alert', style:'display:none'}
#success{class:'alert alert-success', role:'alert', style:'display:none'}

#modal-holder

%form{id:'edit-recipe-form', action:'/editRecipe', method:'post', 'data-remote' => 'true'}
    %input{name: 'authenticity_token',type:'hidden', value:"#{form_authenticity_token}"}
    %div{class:'form-group row'}
        %label{for:'name', class:'col-sm-4 col-form-label'}='Nazwa przepisu'
        %div{class:'col-sm-8'}
            - if @recipe.present?
                %input{name:'Name', type:'text', class:'form-control form-control-obligatory',placeholder:@recipe.Name}
                %input{type:'hidden',name:'recipe',value:@recipe.id}
        %div
            %input{class: 'btn-form', type:'submit', value:'Zapisz zmianę'}

- if @productList.present?
    %div{class:'row'}
        #ingredients
            %table{class:'table'}
                - @productList.each do |product|
                    %tr
                        %td=product.Name
                        %td
                            = link_to '', delete_product_from_recipe_path(recipe: recipe.id, product: product.id), class: 'fas fa-times btn-delete deleteI'

%div{class:'row'}
    = link_to 'Dodaj składniki do przepisu', modal_path(body: 'recipe/add_products', title: 'Dodaj składniki przepisu'), remote: true, 'data-toggle' =>  'modal', 'data-target' => '#modal-holder', class:'btn-form'


%script
    $(document).ready(function (){
    $(".deleteI").click(function () {
    if(!confirm("Czy na pewno chcesz usunąć ten składnik?"))
    return false;
    });
    $(document).off('ajax:success').on('ajax:success',function(event){
    var xhr = event.detail[2];
    if(xhr.responseText == "Add products"){
    $("#modal-holder").html("#{ escape_javascript(render 'modal/modal') }");
    $("#modal-title").html('Dodaj składniki przepisu');
    $("#modal-body").html("#{ escape_javascript(render 'recipes/add_products') }");
    $(".modal").modal('show');
    $(".btn-close").click(function () {
    if(confirm("Czy na pewno chcesz zamknąć to okno?"))
    $(".modal").modal('hide');
    });
    else if(xhr.responseText == "Ingredient deleted")
    $("#success").html("Składnik został usunięty")
    $("#success").css("display","block");
    $("#error").css("display","none");
    }
    else if(xhr.responseText == "Edited name")
    $("#success").html("Nazwa przepisu została zmieniona")
    $("#success").css("display","block");
    $("#error").css("display","none");
    }
    });
